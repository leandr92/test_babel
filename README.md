# BPMN All-In-One Builder

Этот проект упаковывает пример BPMN-моделлера в несколько статических артефактов, совместимых со старыми движками WebKit. Сборщик использует Babel и Rollup, добавляет полифилы, инлайнит CSS/шрифты и выпускает готовый HTML/JS. Это нужно для интеграции BPMN в 1С. Для использования со встроенным в 1С web-kit. Так как стандарт поддержки JS в web-kit встроенный в 1С довольно низкий, BPMNJS пересобирается под стандарт примерно ECMA Script 5

## Что потребуется установить

1. **Node.js** (рекомендуется LTS-версия). Скачайте установщик с [nodejs.org](https://nodejs.org/) и следуйте шагам мастера. В комплекте появится `npm`.
2. (Опционально) **Git**, если хотите клонировать репозиторий. С официального сайта [git-scm.com](https://git-scm.com/).

Если Git не установлен, можно скачать репозиторий архивом (`Code → Download ZIP` на GitHub) и распаковать вручную.

## Первый запуск

1. Скачайте/клонируйте репозиторий и распакуйте его в удобную папку.
2. Откройте терминал и перейдите в каталог проекта:
   ```bash
   cd /путь/к/папке/test_babel/bpmn\ io
   ```
3. Установите зависимости (делается один раз):
   ```bash
   npm install
   ```

## Сборка

Команда ниже последовательно:
- транспилирует исходный код через Babel,
- собирает бандл Rollup’ом,
- создаёт версию с инлайновыми стилями/шрифтами,
- обновляет автономный JS-бандл.

```bash
npm run build
```

После выполнения вы найдёте:

| Файл | Назначение |
| ---- | ---------- |
| `bpmn.html` | HTML с отдельными подключениями дистрибутивов (понятный вариант для отладки). |
| `bpmn_all_in_one.html` | Полностью автономный HTML: включает полифилы, готовый бандл, все CSS и шрифты. |
| `bpmn_all_in_one.js` | Готовый объединённый JS, если нужно подключить всё одной строкой на другой странице. |

Любой из HTML-файлов можно открывать напрямую в браузере без сервера: `⌘O` → выбрать файл, или перетащить в окно браузера.

## Дополнительные команды

- `npm run build:watch` — запускает Rollup в режиме слежения за `src/`; удобно во время разработки, затем повторно выполните `npm run build`, чтобы обновить итоговые артефакты.

## Обновление Node.js / очистка

Если во время `npm install` или `npm run build` появляются ошибки, попробуйте:
- Обновить Node.js до актуальной LTS-версии.
- Удалить папку `node_modules` и файл `package-lock.json`, затем повторить `npm install`.

## Где править код

- **Исходный код**: `src/main.js` и вспомогательные файлы.
- **HTML-шаблон**: `src/bpmn.template.html` (сюда добавляйте стили/разметку; слот `<!-- INLINE_BUNDLE -->` заполняется автоматически).
- **Скрипт сборки**: `scripts/build-html.js` — отвечает за инлайнинг и выпуск финальных файлов.

## Поддержка старых WebKit

Сборка таргетирует Safari 9 / ранние WebKit: добавлены необходимые полифилы, отключены современные конструкции (`optional chaining`, `let/const` и т. д.). Чтобы проверить совместимость на своём устройстве, просто откройте `bpmn_all_in_one.html` в нужном браузере.

Удачной работы!
